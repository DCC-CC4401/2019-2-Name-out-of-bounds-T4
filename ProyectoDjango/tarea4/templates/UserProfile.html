{% extends 'base.html' %}
{% load staticfiles %}
{% block body %}


    <!--CONTENIDO PAGINA-->
    <div class="container-fluid p-4 main">
        <div class="row">
            <img src="{{user.usuario.foto.url}}" class="circular mx-auto d-block shadow" height="250px">
        </div>
        <div class="row py-4">
            <div class="col text-center">
                <p class="h4 text-center text-dark">{{ user.first_name}} {{ user.last_name }}</p>
                <a href="cambioImagen" class="btn btn-success" role="button">Cambiar Imagen</a>
            </div>
        </div>

        <!--MENU CON TABS-->

        <!--PESTAÑAS-->
        <div class="row px-5">
            <div class="col offset-sm-2 col-sm-8">
                <ul class="nav nav-tabs" id="pestañas-perfil-de-usuario" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link nav-link-fix active" id="profile-tab-mi-perfil" data-toggle="tab"
                           href="#Perfil" role="tab" aria-controls="home" aria-selected="true">Mi Perfil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-fix" id="contact-tab-amigos" data-toggle="tab" href="#Amigos"
                           role="tab" aria-controls="contact" aria-selected="false">Amigos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-fix" id="contact-tab-actividades" data-toggle="tab"
                           href="#Actividades" role="tab" aria-controls="contact" aria-selected="false">Mis
                            Actividades</a>
                    </li>
                </ul>
            </div>
        </div>

        <!--CONTENIDO DE LAS PESTAÑAS-->
        <div class="row px-5">
            <div class="tab-content p-4 offset-sm-2 col-sm-8" id="myTabContent">

                <!--PESTAÑA MI PERFIL-->
                <div class="tab-pane fade show active" id="Perfil" role="tabpanel" aria-labelledby="Perfil-tab">

                    <p class="h5 text-dark">Nombre : {{ user.first_name }}</p>
                    <p class="h5 text-dark">Apellido: {{ user.last_name }}</p>
                    <p class="h5 text-dark">Correo: {{ user.email }}</p>
                    <a href="cambioContraseña" class="btn btn-success" role="button">Cambiar Contraseña</a>

                </div>
                <!--PESTAÑA AMIGOS-->
                <div class="tab-pane fade" id="Amigos" role="tabpanel" aria-labelledby="Amigos-tab">

                    <div class="input-group mb-3">
                        <!-- Nose porque al añadir el form se echa a perder el formato :c -->
                        <form action="{% url 'perfil' %}" method="GET">
                            <table>
                            <tr>
                                <td><input name="q" class="form-control" type="text" placeholder="Buscar amigos"></td>

                                <td><button class="btn btn-secondary" type="submit">Buscar</button></td>
                            </tr>

                            </table>
                        </form>
                    </div>
                        <!--
                        <input type="text" class="form-control" placeholder="Buscar amigos"
                               aria-label="Recipient's username" aria-describedby="button-addon2">

                        <div class="input-group-append">
                            <button class="btn btn-secondary" type="button" id="button-addon2">Buscar</button>
                        </div>
                        -->

                     Enviar solicitud de Amistad
                    <div class="card spaced" style="width: 100%;">
                        <div class="card-header">
                            Resultados búsqueda
                            <!-- Bug con el id, al hacer click en el boton de busqueda se abren los amigos tambien -->
                            <button class="btn btn-sm btn-success float-right" type="button" data-toggle="collapse"
                                    data-target="#friends-list" aria-expanded="false" aria-controls="friends-list"
                                    id="friends-toggle" onclick="toggleName(this.id)">Ver más
                            </button>
                        </div>
                        <ul class="list-group list-group-flush collapse" id="friends-list">

                            {% for persona in object_list %}

                                <li class="list-group-item">
                                <img src="{{persona.foto.url}}" width="70px" height="50px">
                                    <a href="404" class="fr-link">
                                           {{ persona.user.first_name }} {{ persona.user.last_name }}</a>
                                <form action="{% url 'perfil' %}" method="post">
                                    {% csrf_token %}
                                    <input type="hidden" name="email" value="{{ persona.user.email }}"/> <!-- llave de la persona -->
                                    <button type="submit" name="agregar_amigo" class="btn btn-sm btn-outline-success float-right">Agregar amigo</button>

                                </form>
                                </li>
                            {% endfor %}

                        </ul>
                    </div>

                    <!-- Solicitudes de amistad -->
                    <div class="card spaced" style="width: 100%;">
                        <div class="card-header">
                            Solicitudes
                            <button class="btn btn-sm btn-success float-right" type="button" data-toggle="collapse"
                                    data-target="#friends-request-list" aria-expanded="false"
                                    aria-controls="friends-list"
                                    id="friends-request-toggle" onclick="toggleName(this.id)">Ver más
                            </button>
                        </div>
                        <ul class="list-group list-group-flush collapse" id="friends-request-list">

                            {% for solicitud in sol %}

                                <li class="list-group-item">
                                <img src="{{solicitud.user_2.foto.url}}" width="70px" height="50px">
                                    <a href="404" class="fr-link">
                                           {{ solicitud.user_2.user.first_name }} {{ solicitud.user_2.user.last_name }}</a>
                                <form action="{% url 'perfil' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="email" value="{{ solicitud.user_2.user.email }}"/>
                                    <button type="submit" name="aceptar_sol" class="btn btn-sm btn-outline-success float-right">Aceptar
                                    </button>
                                    <p class="float-right" style="margin-left: 10px"></p>
                                    <button type="submit" name="rechazar_sol" class="btn btn-sm btn-outline-danger float-right">Rechazar
                                    </button>
                                </form>
                                </li>

                            {% endfor %}

                        </ul>
                    </div>

                    <!-- Amigos aceptados -->
                    <div class="card spaced" style="width: 100%;">
                        <div class="card-header">
                            Amigos
                            <button class="btn btn-sm btn-success float-right" type="button" data-toggle="collapse"
                                    data-target="#friends-list" aria-expanded="false" aria-controls="friends-list"
                                    id="friends-toggle" onclick="toggleName(this.id)">Ver más
                            </button>
                        </div>
                        <ul class="list-group list-group-flush collapse" id="friends-list">
                            {% for amigo in amigos %}

                                <li class="list-group-item">
                                <img src="{{amigo.user_2.foto.url}}" width="70" height="50px">
                                    <a href="404" class="fr-link">
                                           {{ amigo.user_2.user.first_name }} {{ amigo.user_2.user.last_name }}</a>
                                <form action="{% url 'perfil' %}" method="POST">
                                    {% csrf_token %}
                                    <input type="hidden" name="email" value="{{ amigo.user_2.user.email }}"/>
                                    <button type="submit" name="eliminar_amigo" class="btn btn-sm btn-outline-danger float-right">Eliminar
                                    </button>
                                </form>
                                </li>

                            {% endfor %}

                        </ul>
                    </div>
                </div>

                <!-- PESTAÑA ACTIVIDADES -->
                <div class="tab-pane fade" id="Actividades" role="tabpanel" aria-labelledby="Actividades-tab">

                    <button type="button" class="btn btn-primary btn-lg btn-block"> Crear una nueva actividad</button>

                    <div class="card spaced">
                        <div class="card-body sleep-activity text-white">
                            <img src="{% static 'img/bed.png' %}" class="activity-icon invert-color mx-2"> Dormir
                            <button type="button" class="btn btn-sm btn-primary float-right"> Ver info</button>
                        </div>
                    </div>

                    <div class="card spaced">
                        <div class="card-body study-activity text-white">
                            <img src="{% static 'img/open-book.png' %}" class="activity-icon invert-color mx-2"> Estudiar
                            <button type="button" class="btn btn-sm btn-primary float-right"> Ver info</button>
                        </div>
                    </div>

                    <div class="card spaced">
                        <div class="card-body eat-activity text-white">
                            <img src="{%  static 'img/crossed-knife-and-fork.png' %}" class="activity-icon invert-color mx-2"> Almorzar
                            <button type="button" class="btn btn-sm btn-primary float-right"> Ver info</button>
                        </div>
                    </div>

                    <div class="card spaced">
                        <div class="card-body house-activity text-white">
                            <img src="{% static 'img/washing-machine.png' %}" class="activity-icon invert-color mx-2"> Lavar ropa
                            <button type="button" class="btn btn-sm btn-primary float-right"> Ver info</button>
                        </div>
                    </div>

                    <div class="card spaced">
                        <div class="card-body animal-activity text-white">
                            <img src="{% static  'img/snowshoe-cat.png' %}" class="activity-icon invert-color mx-2"> Jugar con el Michi
                            <button type="button" class="btn btn-sm btn-primary float-right"> Ver info</button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>


<!-- BOOTSTRAP JS, DO NOT DELETE -->
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
        integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
        crossorigin="anonymous"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/toggleName.js"></script>

{% endblock %}
